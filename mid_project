#include <gl/freeglut.h> //중간과제 1-7까지는 여기다가 해야됨.
#include<iostream>
#include<math.h>
#define PI 3.141592
float nameOffsetX = 0.0;
float gieokOffsetY = 0.0;
float nameScaleCenter = 1.0;
const float namePivotX = 0.515;
const float namePivotY = -0.565;
float vowelIScale = 1.0; 
const float vowelIPivotX = 0.29;  
const float vowelIPivotY = -0.50;
bool moveAnimOn = false;  
int moveDirX = 1;      
int gieokDirY = 1;
float nameRotZ = 0.0;  
float jongRotX = 0.0;   
bool rotAnimOn = false;
float nameRotVelZ = 0.2;   
float jongRotVelX = 0.2;   
const float nameCenterRefX = 0.515; 
const float nameCenterRefY = -0.565; 
const float jongCenterRefX = 0.655;
const float jongCenterRefY = -0.7;
float jongScaleFactor = 1.0; 
bool scaleAnimOn = false;  
int nameScaleDir = 1;       
int vowelIScaleDir = 1;    
const float jongPivotTopLeftX = 0.55;   
const float jongPivotTopLeftY = -0.63; 
bool bothScaleAnimOn = false;
int  jongScaleDir = 1;        
float walkPhase = 0.0;   
bool walkAnimOn = false;    
float bodyOffsetX = 0.0;        
float armAngleDeg = 0.0; 
float legAngleDeg = 0.0;     
int armSwingDir = 1;        
int legSwingDir = -1;           
const float ARM_MAX = 20.0;
const float LEG_MAX = 25.0;
float speedFactor = 0.05;
float shoulderRightAngle = 0.0, shoulderLeftAngle = 0.0;  
float elbowRightAngle = 0.0, elbowLeftAngle = 0.0;  
float hipLeftAngle = 0.0, hipRightAngle = 0.0;  
float kneeLeftAngle = 0.0, kneeRightAngle = 0.0;  
float bodyBounceY = 0.0;                    
const float SHOULDER_MAX = 90.0;
const float ELBOW_MAX = 35.0;
const float HIP_MAX = 35.0;
const float KNEE_MAX = 35.0;
const float BOB_MAX = 0.03;
bool marchModeOn = false;  
float toolRotateAroundNameY = 0.0;  
float nameRotateAroundToolY = 0.0;   
const float toolCenterX = 0.65;   
const float toolCenterY = 0.25;   
float nameScaleTopRight = 1.0;
const float namePivotTopRightX = 0.75;
const float namePivotTopRightY = -0.40;
int trScaleDir = 1;   


void drawLeeGaYeon(void)
{
    glPushMatrix();
    glTranslatef(0.2, -0.5, 0.0);
    glColor3f(0.0, 0.0, 0.0);
    glutSolidSphere(0.05, 100, 100);
    glPopMatrix();

    // ㅣ (오른쪽 세로막대)
    glPushMatrix();
    glTranslatef(vowelIPivotX, vowelIPivotY, 0.0f);
    glScalef(vowelIScale, vowelIScale, 1.0);
    glTranslatef(-vowelIPivotX, -vowelIPivotY, 0.0f);
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.28, -0.4, 0.0);
    glVertex3f(0.28, -0.6, 0.0);
    glVertex3f(0.3, -0.6, 0.0);
    glVertex3f(0.3, -0.4, 0.0);
    glEnd();
    glPopMatrix();

    // ㄱ : 위 가로 + 왼쪽 세로
    glPushMatrix();
    glRotatef(-nameRotateAroundToolY, 0.0f, 1.0f, 0.0f);
    glTranslatef(0.0f, gieokOffsetY, 0.0f);
    glRotatef(+nameRotateAroundToolY, 0.0f, 1.0f, 0.0f);
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.35, -0.45, 0.0);
    glVertex3f(0.35, -0.48, 0.0);
    glVertex3f(0.4, -0.48, 0.0);
    glVertex3f(0.4, -0.45, 0.0);
    glEnd();
    // 왼쪽 세로
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.4, -0.45, 0.0);
    glVertex3f(0.4, -0.54, 0.0);
    glVertex3f(0.43, -0.54, 0.0);
    glVertex3f(0.43, -0.45, 0.0);
    glEnd();
    glPopMatrix();

    // ㅏ : 오른쪽 세로 + 가운데 짧은 가로
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.45, -0.4, 0.0);
    glVertex3f(0.45, -0.6, 0.0);
    glVertex3f(0.475, -0.6, 0.0);
    glVertex3f(0.475, -0.4, 0.0);
    glEnd();
    // 가운데 짧은 가로
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.475, -0.51, 0.0);
    glVertex3f(0.475, -0.54, 0.0);
    glVertex3f(0.5, -0.54, 0.0);
    glVertex3f(0.5, -0.51, 0.0);
    glEnd();

    // ㅇ (참고용 점)
    glPushMatrix();
    glTranslatef(0.6, -0.5, 0.0);
    glColor3f(0.0, 0.0, 0.0);
    glutSolidSphere(0.05, 100, 100);
    glPopMatrix();

    // ㅕ : 왼쪽 세로 + 오른쪽 짧은 획 2개
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.7, -0.4, 0.0);
    glVertex3f(0.7, -0.6, 0.0);
    glVertex3f(0.75, -0.6, 0.0);
    glVertex3f(0.75, -0.4, 0.0);
    glEnd();
    // 짧은 획 (위)
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.65, -0.46, 0.0);
    glVertex3f(0.65, -0.49, 0.0);
    glVertex3f(0.7, -0.49, 0.0);
    glVertex3f(0.7, -0.46, 0.0);
    glEnd();
    // 짧은 획 (아래)
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.65, -0.51, 0.0);
    glVertex3f(0.65, -0.54, 0.0);
    glVertex3f(0.7, -0.54, 0.0);
    glVertex3f(0.7, -0.51, 0.0);
    glEnd();

    // ㄴ : 아래 가로 + 왼쪽 세로
    glPushMatrix();
    glTranslatef(jongPivotTopLeftX, jongPivotTopLeftY, 0.0f);
    glRotatef(jongRotX, 1.0f, 0.0f, 0.0f);
    glScalef(jongScaleFactor, jongScaleFactor, 1.0f);
    glTranslatef(-jongPivotTopLeftX, -jongPivotTopLeftY, 0.0f);

    // 왼쪽 세로 (아래쪽)
    glColor3f(0.0, 0.0, 0.0);
    glBegin(GL_QUADS);
    glVertex3f(0.55, -0.63, 0.0);
    glVertex3f(0.55, -0.73, 0.0);
    glVertex3f(0.58, -0.73, 0.0);
    glVertex3f(0.58, -0.63, 0.0);
    glEnd();
    // 아래 가로
    glBegin(GL_QUADS);
    glVertex3f(0.58, -0.68, 0.0);
    glVertex3f(0.58, -0.73, 0.0);
    glVertex3f(0.75, -0.73, 0.0);
    glVertex3f(0.75, -0.68, 0.0);
    glEnd();

    glPopMatrix();
}

//캐릭터 
void drawcharacter(void) {
    // 머리(구)
    glPushMatrix();
    glTranslatef(-0.60, 0.35, 0.0f);
    glColor3f(0.95, 0.85, 0.75);
    glutSolidSphere(0.12, 32, 32);
    glPopMatrix();
    // 몸통 박스 
    glColor3f(0.0f, 1.0f, 0.0f);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.70, -0.20, 0.02);
    glVertex3f(-0.50, -0.20, 0.02);
    glVertex3f(-0.50, 0.20, 0.02);
    glVertex3f(-0.70, 0.20, 0.02);
    glEnd();

    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.70, -0.20, -0.02);
    glVertex3f(-0.70, 0.20, -0.02);
    glVertex3f(-0.50, 0.20, -0.02);
    glVertex3f(-0.50, -0.20, -0.02);
    glEnd();

    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.70, -0.20, -0.02); 
    glVertex3f(-0.70, -0.20, 0.02);
    glVertex3f(-0.50, -0.20, -0.02);
    glVertex3f(-0.50, -0.20, 0.02);
    glVertex3f(-0.50, 0.20, -0.02); 
    glVertex3f(-0.50, 0.20, 0.02);
    glVertex3f(-0.70, 0.20, -0.02); 
    glVertex3f(-0.70, 0.20, 0.02);
    glEnd();

    // 오른팔 윗팔
    glPushMatrix();
    glTranslatef(-0.50, 0.15, 0.0);
    glRotatef(shoulderRightAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.50, -0.15, 0.0);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.50f, -0.05, 0.02);
    glVertex3f(-0.43, -0.05, 0.02);
    glVertex3f(-0.43, 0.15, 0.02);
    glVertex3f(-0.50, 0.15, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.50, -0.05, -0.02);
    glVertex3f(-0.50, 0.15, -0.02);
    glVertex3f(-0.43, 0.15, -0.02);
    glVertex3f(-0.43, -0.05, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.50, -0.05, -0.02);
    glVertex3f(-0.50, -0.05, 0.02);
    glVertex3f(-0.43, -0.05, -0.02); 
    glVertex3f(-0.43, -0.05, 0.02);
    glVertex3f(-0.43, 0.15, -0.02);
    glVertex3f(-0.43, 0.15, 0.02);
    glVertex3f(-0.50, 0.15, -0.02); 
    glVertex3f(-0.50, 0.15, 0.02);
    glEnd();

    // 오른팔 아랫팔
    glPushMatrix();
    glTranslatef(-0.50, -0.05, 0.0);
    glRotatef(elbowRightAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.50, 0.05, 0.0);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.50, -0.25, 0.02);
    glVertex3f(-0.43, -0.25, 0.02);
    glVertex3f(-0.43, -0.05, 0.02);
    glVertex3f(-0.50, -0.05, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.50, -0.25, -0.02);
    glVertex3f(-0.50, -0.05, -0.02);
    glVertex3f(-0.43, -0.05, -0.02);
    glVertex3f(-0.43, -0.25, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.50, -0.25, -0.02); 
    glVertex3f(-0.50, -0.25, 0.02);
    glVertex3f(-0.43, -0.25, -0.02); 
    glVertex3f(-0.43, -0.25, 0.02);
    glVertex3f(-0.43, -0.05, -0.02); 
    glVertex3f(-0.43, -0.05, 0.02);
    glVertex3f(-0.50, -0.05, -0.02); 
    glVertex3f(-0.50, -0.05, 0.02);
    glEnd();

    glPopMatrix(); 
    glPopMatrix();

    // 왼팔 윗팔
    glPushMatrix();
    glTranslatef(-0.70, 0.15, 0.0);
    glRotatef(shoulderLeftAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.70, -0.15, 0.0);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.77, -0.05, 0.02);
    glVertex3f(-0.70, -0.05, 0.02);
    glVertex3f(-0.70, 0.15, 0.02);
    glVertex3f(-0.77, 0.15, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.77, -0.05, -0.02);
    glVertex3f(-0.77, 0.15, -0.02);
    glVertex3f(-0.70, 0.15, -0.02);
    glVertex3f(-0.70, -0.05, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.77, -0.05, -0.02); 
    glVertex3f(-0.77, -0.05, 0.02);
    glVertex3f(-0.70, -0.05, -0.02); 
    glVertex3f(-0.70, -0.05, 0.02);
    glVertex3f(-0.70, 0.15, -0.02); 
    glVertex3f(-0.70, 0.15, 0.02);
    glVertex3f(-0.77, 0.15, -0.02); 
    glVertex3f(-0.77, 0.15, 0.02);
    glEnd();

    // 왼팔 아랫팔
    glPushMatrix();
    glTranslatef(-0.70, -0.05, 0.0);
    glRotatef(elbowLeftAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.70, 0.05, 0.0);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.77, -0.25, 0.02);
    glVertex3f(-0.70, -0.25, 0.02);
    glVertex3f(-0.70, -0.05, 0.02);
    glVertex3f(-0.77, -0.05, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.77, -0.25, -0.02);
    glVertex3f(-0.77, -0.05, -0.02);
    glVertex3f(-0.70, -0.05, -0.02);
    glVertex3f(-0.70, -0.25, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.77, -0.25, -0.02); 
    glVertex3f(-0.77, -0.25, 0.02);
    glVertex3f(-0.70, -0.25, -0.02); 
    glVertex3f(-0.70, -0.25, 0.02);
    glVertex3f(-0.70, -0.05, -0.02); 
    glVertex3f(-0.70, -0.05, 0.02);
    glVertex3f(-0.77, -0.05, -0.02); 
    glVertex3f(-0.77, -0.05, 0.02);
    glEnd();

    glPopMatrix();  // 팔꿈치 래핑 끝
    glPopMatrix();

    // 오른다리 윗다리
    glPushMatrix();
    glTranslatef(-0.54, -0.20, 0.0);
    glRotatef(hipRightAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.54, 0.20, 0.0);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.58, -0.45, 0.02);
    glVertex3f(-0.50, -0.45, 0.02);
    glVertex3f(-0.50, -0.20, 0.02);
    glVertex3f(-0.58, -0.20, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.58, -0.45, -0.02);
    glVertex3f(-0.58, -0.20, -0.02);
    glVertex3f(-0.50, -0.20, -0.02);
    glVertex3f(-0.50, -0.45, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.58, -0.45, -0.02); 
    glVertex3f(-0.58, -0.45, 0.02);
    glVertex3f(-0.50, -0.45, -0.02); 
    glVertex3f(-0.50, -0.45, 0.02);
    glVertex3f(-0.50, -0.20, -0.02); 
    glVertex3f(-0.50, -0.20, 0.02);
    glVertex3f(-0.58, -0.20, -0.02); 
    glVertex3f(-0.58, -0.20, 0.02);
    glEnd();

    // 오른다리 아랫다리
    glPushMatrix();
    glTranslatef(-0.54, -0.45, 0.0);
    glRotatef(kneeRightAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.54f,0.45, 0.0f);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.58, -0.70, 0.02);
    glVertex3f(-0.50, -0.70, 0.02);
    glVertex3f(-0.50, -0.45, 0.02);
    glVertex3f(-0.58, -0.45, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.58, -0.70, -0.02);
    glVertex3f(-0.58, -0.45, -0.02);
    glVertex3f(-0.50, -0.45, -0.02);
    glVertex3f(-0.50, -0.70, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.58, -0.70, -0.02); 
    glVertex3f(-0.58, -0.70, 0.02);
    glVertex3f(-0.50, -0.70, -0.02); 
    glVertex3f(-0.50, -0.70, 0.02);
    glVertex3f(-0.50, -0.45, -0.02); 
    glVertex3f(-0.50, -0.45, 0.02);
    glVertex3f(-0.58, -0.45, -0.02); 
    glVertex3f(-0.58, -0.45, 0.02);
    glEnd();

    glPopMatrix();  // 무릎 래핑 끝
    glPopMatrix();

    // 왼다리 윗다리
    glPushMatrix();
    glTranslatef(-0.66, -0.20, 0.0);
    glRotatef(hipLeftAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.66, 0.20, 0.0);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.70, -0.45, 0.02);
    glVertex3f(-0.62, -0.45, 0.02);
    glVertex3f(-0.62, -0.20, 0.02);
    glVertex3f(-0.70, -0.20, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.70, -0.45, -0.02);
    glVertex3f(-0.70, -0.20, -0.02);
    glVertex3f(-0.62, -0.20, -0.02);
    glVertex3f(-0.62, -0.45, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.70, -0.45, -0.02); 
    glVertex3f(-0.70, -0.45, 0.02);
    glVertex3f(-0.62, -0.45, -0.02); 
    glVertex3f(-0.62, -0.45, 0.02);
    glVertex3f(-0.62, -0.20, -0.02); 
    glVertex3f(-0.62, -0.20, 0.02);
    glVertex3f(-0.70, -0.20, -0.02); 
    glVertex3f(-0.70, -0.20, 0.02);
    glEnd();

    // 왼다리 아랫다리
    glPushMatrix();
    glTranslatef(-0.66, -0.45, 0.0);
    glRotatef(kneeLeftAngle, 1.0, 0.0, 0.0);
    glTranslatef(0.66, 0.45, 0.0);

    glColor3f(0.0, 1.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.70, -0.70, 0.02);
    glVertex3f(-0.62, -0.70, 0.02);
    glVertex3f(-0.62, -0.45, 0.02);
    glVertex3f(-0.70, -0.45, 0.02);
    glEnd();
    glColor3f(1.0, 0.0, 0.0);
    glBegin(GL_LINE_LOOP);
    glVertex3f(-0.70, -0.70, -0.02);
    glVertex3f(-0.70, -0.45, -0.02);
    glVertex3f(-0.62, -0.45, -0.02);
    glVertex3f(-0.62, -0.70, -0.02);
    glEnd();
    glColor3f(0.0, 0.0, 1.0);
    glBegin(GL_LINES);
    glVertex3f(-0.70, -0.70, -0.02); 
    glVertex3f(-0.70, -0.70, 0.02);
    glVertex3f(-0.62, -0.70, -0.02); 
    glVertex3f(-0.62, -0.70, 0.02);
    glVertex3f(-0.62, -0.45, -0.02); 
    glVertex3f(-0.62, -0.45, 0.02);
    glVertex3f(-0.70, -0.45, -0.02); 
    glVertex3f(-0.70, -0.45, 0.02);
    glEnd();

    glPopMatrix(); 
    glPopMatrix();
}

void drawtool(void) {
    glPushMatrix();

    // 정육면체 책상
    glPushMatrix();
    glTranslatef(0.65, 0.25, 0.0);
    glColor3f(0.72, 0.45, 0.20);
    glScalef(0.35, 0.35, 0.35);
    glutSolidCube(1.0);
    glPopMatrix();

    glPushMatrix();
    glTranslatef(0.65, 0.25, 0.0);
    glColor3f(0.0, 0.0, 0.0);
    glScalef(0.35 * 1.003, 0.35 * 1.003, 0.35 * 1.003);
    glutWireCube(1.0);
    glPopMatrix();

    // 책상 위 주전자
    glPushMatrix();
    glTranslatef(0.72, 0.46, 0.0);
    glColor3f(0.60, 0.80, 0.95);
    glutSolidTeapot(0.08);
    glColor3f(0.0, 0.0, 0.0);
    glutWireTeapot(0.08);
    glPopMatrix();

    glPushMatrix();
    glTranslatef(0.58, 0.46, 0.0);
    glRotatef(25.0, 1.0, 0.0, 0.0);
    glRotatef(-20.0, 0.0, 1.0, 0.0);
    glColor3f(0.85, 0.15, 0.10);     
    glutSolidTorus(0.025, 0.080, 32, 64); 
    glColor3f(0.0, 0.0, 0.0);
    glutWireTorus(0.025, 0.080, 16, 32);
    glPopMatrix();

    glPopMatrix();
}


void animate(void) {
    if (moveAnimOn) {
        nameOffsetX += 0.0015* moveDirX;
        if (nameOffsetX > 0.3 || nameOffsetX < -0.3) moveDirX *= -1;

        gieokOffsetY += 0.0015 * gieokDirY;
        if (gieokOffsetY > 0.3 || gieokOffsetY < -0.3) gieokDirY *= -1;
    }
    if (rotAnimOn) {
        nameRotZ += nameRotVelZ;  
        jongRotX += jongRotVelX;  
    }

    if (moveAnimOn || rotAnimOn) glutPostRedisplay();

    if (scaleAnimOn) {
        nameScaleCenter += 0.003 * nameScaleDir;
        if (nameScaleCenter > 1.4 || nameScaleCenter < 0.7) nameScaleDir *= -1;

        vowelIScale += 0.003 * vowelIScaleDir;
        if (vowelIScale > 2.5 || vowelIScale < 0.3) vowelIScaleDir *= -1;
    }

    if (bothScaleAnimOn) {
        jongScaleFactor += 0.003 * jongScaleDir;
        if (jongScaleFactor > 1.5 || jongScaleFactor < 0.6f) jongScaleDir *= -1;

        nameScaleTopRight += 0.003 * trScaleDir;
        if (nameScaleTopRight > 1.4 || nameScaleTopRight < 0.7) trScaleDir *= -1;
    }

    if (moveAnimOn || rotAnimOn || scaleAnimOn || bothScaleAnimOn) glutPostRedisplay();

    if (!walkAnimOn) return;

    const float step = 0.6f * speedFactor;

    const float ARM_SWING = marchModeOn ? 35.0 : 28.0;   
    const float HIP_SWING = marchModeOn ? 45.0 : 34.0; 
    const float ELBOW_MAX_LOCAL = marchModeOn ? 25.0 : 14.0; 
    const float KNEE_MAX_LOCAL = marchModeOn ? 55.0 : 26.0;  
    const float BOB_MAX_LOCAL = marchModeOn ? 0.035 : 0.028; 

    // 팔
    shoulderRightAngle += step * armSwingDir;
    if (shoulderRightAngle >= ARM_SWING) { shoulderRightAngle = ARM_SWING; armSwingDir = -1; }
    else if (shoulderRightAngle <= -ARM_SWING) { shoulderRightAngle = -ARM_SWING; armSwingDir = 1; }
    shoulderLeftAngle = -shoulderRightAngle;

    // 팔꿈치
    float tR = (shoulderRightAngle > 0 ? shoulderRightAngle : 0) / ARM_SWING;
    float tL = (shoulderLeftAngle > 0 ? shoulderLeftAngle : 0) / ARM_SWING;
    elbowRightAngle = ELBOW_MAX_LOCAL * tR;
    elbowLeftAngle = ELBOW_MAX_LOCAL * tL;

    // 다리
    float ratio = HIP_SWING / ARM_SWING;
    hipLeftAngle = -shoulderRightAngle * ratio;
    hipRightAngle = -shoulderLeftAngle * ratio;

    // 무릎
    kneeLeftAngle = (hipLeftAngle > 0 ? (hipLeftAngle / HIP_SWING) * KNEE_MAX_LOCAL : 0.0f);
    kneeRightAngle = (hipRightAngle > 0 ? (hipRightAngle / HIP_SWING) * KNEE_MAX_LOCAL : 0.0f);

    // 바운싱
    float absRight = (shoulderRightAngle < 0.0f) ? -shoulderRightAngle : shoulderRightAngle;
    float centered = 1.0 - (absRight / ARM_SWING);
    if (centered < 0.0) centered = 0.0;
    bodyBounceY = BOB_MAX_LOCAL * centered;


    // 걷기
    if (!marchModeOn) {
        bodyOffsetX += 0.0015 * speedFactor;
        if (bodyOffsetX > 1.2) bodyOffsetX = -1.2;
    }

    glutPostRedisplay();
}

void keyboard(unsigned char key, int x, int y) {
    switch (key) {
    case '1': nameOffsetX -= 0.2; glutPostRedisplay(); break;
    case '2': nameOffsetX += 0.2; glutPostRedisplay(); break;
    case '3': gieokOffsetY += 0.1; glutPostRedisplay(); break;
    case '4': gieokOffsetY -= 0.1; glutPostRedisplay(); break;

    case '5':
        moveAnimOn = !moveAnimOn;
        if (moveAnimOn || rotAnimOn || scaleAnimOn || bothScaleAnimOn) glutIdleFunc(animate);
        else glutIdleFunc(NULL);
        break;

    case 'a': nameScaleCenter *= 1.1; glutPostRedisplay(); break;
    case 'b': nameScaleCenter *= 0.9; glutPostRedisplay(); break;
    case 'c': vowelIScale *= 1.3; glutPostRedisplay(); break; 
    case 'd': vowelIScale *= 0.5; glutPostRedisplay(); break;

    case 'e':
        scaleAnimOn = !scaleAnimOn;
        if (moveAnimOn || rotAnimOn || scaleAnimOn || bothScaleAnimOn) glutIdleFunc(animate);
        else glutIdleFunc(NULL);
        break;

    case 'f': nameRotZ -= 5.0; glutPostRedisplay(); break; 
    case 'g': nameRotZ += 5.0; glutPostRedisplay(); break;

    case 'h': jongRotX -= 5.0; glutPostRedisplay(); break; // 시계
    case 'i': jongRotX += 5.0; glutPostRedisplay(); break; // 반시계

    case 'j':
        rotAnimOn = !rotAnimOn;
        if (moveAnimOn || rotAnimOn || scaleAnimOn || bothScaleAnimOn) glutIdleFunc(animate);
        else glutIdleFunc(NULL);
        break;

    case 'k': nameScaleTopRight *= 1.1; glutPostRedisplay(); break; 
    case 'l': nameScaleTopRight *= 0.9; glutPostRedisplay(); break; 

    case 'm': jongScaleFactor *= 1.1; glutPostRedisplay(); break; 
    case 'n': jongScaleFactor *= 0.9; glutPostRedisplay(); break; 

    case 'o':
        bothScaleAnimOn = !bothScaleAnimOn;
        if (moveAnimOn || rotAnimOn || scaleAnimOn || bothScaleAnimOn) glutIdleFunc(animate);
        else glutIdleFunc(NULL);
        break;

    case 'r':
        walkAnimOn = !walkAnimOn;
        if (walkAnimOn || moveAnimOn || rotAnimOn || scaleAnimOn || bothScaleAnimOn) glutIdleFunc(animate);
        else glutIdleFunc(NULL);
        break;

    case 'p':
        toolRotateAroundNameY += 5.0;
        if (toolRotateAroundNameY >= 360.0) toolRotateAroundNameY -= 360.0;
        glutPostRedisplay();
        break;

    case 'q':
        nameRotateAroundToolY += 5.0;
        if (nameRotateAroundToolY >= 360.0) nameRotateAroundToolY -= 360.0;
        glutPostRedisplay();
        break;


    default: break;
    }
}

void display(void)
{
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
    glLoadIdentity();

    glPushMatrix();
    glTranslatef(toolCenterX, toolCenterY, 0.0);
    glRotatef(nameRotateAroundToolY, 0.0, 1.0, 0.0);
    glTranslatef(-toolCenterX, -toolCenterY, 0.0);

    glPushMatrix();
    glTranslatef(namePivotX, namePivotY, 0.0);
    glRotatef(nameRotZ, 0.0, 0.0, 1.0);
    if (!bothScaleAnimOn) {
        glScalef(nameScaleCenter, nameScaleCenter, 1.0);
    }
    glTranslatef(-namePivotX, -namePivotY, 0.0);

    glTranslatef(namePivotTopRightX, namePivotTopRightY, 0.0);
    glScalef(nameScaleTopRight, nameScaleTopRight, 1.0);
    glTranslatef(-namePivotTopRightX, -namePivotTopRightY, 0.0);

    glTranslatef(nameOffsetX, 0.0, 0.0);

    drawLeeGaYeon();
    glPopMatrix();
    glPopMatrix();

    glPushMatrix();
    glTranslatef(bodyOffsetX, bodyBounceY, 0.0);
    glTranslatef(-0.60, 0.0, 0.0);
    glRotatef(12.0, 0.0, 1.0, 0.0);
    glTranslatef(0.60, 0.0, 0.0);
    drawcharacter();
    glPopMatrix();

    float nameCenterX = namePivotX + nameOffsetX;
    float nameCenterY = namePivotY;

    glPushMatrix();
    glTranslatef(nameCenterX, nameCenterY, 0.0);
    glRotatef(toolRotateAroundNameY, 0.0, 1.0, 0.0);
    glTranslatef(-nameCenterX, -nameCenterY, 0.0);

    drawtool();
    glPopMatrix();

    glFlush();
}

int main(int argc, char** argv)
{
    glutInit(&argc, argv);
    glutInitDisplayMode(GLUT_RGBA | GLUT_DEPTH | GLUT_SINGLE);
    glutCreateWindow("Transformation");
    glClearColor(1.0, 1.0, 1.0, 0.0); 
    glutDisplayFunc(display);
    glutKeyboardFunc(keyboard);
    glutMainLoop();
    return 0;
}
